[workspace]
name = "raft"
version = "0.1.0"
description = "RAFT: Recurrent All Pairs Field Transforms for Optical Flow"
authors = ["Zachary Teed <zteed@princeton.edu>"]
channels = ["pytorch", "nvidia", "conda-forge"]
platforms = ["linux-64"]

[system-requirements]
cuda = "12.1"

[dependencies]
python = "3.10.*"
pytorch = "2.1.*"
torchvision = "0.16.*"
pytorch-cuda = "12.1.*"
matplotlib = "*"
tensorboard = "*"
scipy = "*"
pip = "*"

# Use PyPI dependencies for opencv to avoid channel conflicts
[pypi-dependencies]
opencv-python = "*"

[tasks]
# Demo tasks
demo = "python demo.py --model=models/raft-things.pth --path=demo-frames"
demo-kitti = "python demo.py --model=models/raft-kitti.pth --path=demo-frames"
demo-sintel = "python demo.py --model=models/raft-sintel.pth --path=demo-frames"

# Evaluation tasks
eval-sintel = "python evaluate.py --model=models/raft-things.pth --dataset=sintel --mixed_precision"
eval-kitti = "python evaluate.py --model=models/raft-kitti.pth --dataset=kitti --mixed_precision"

# Training tasks
train = "bash train_standard.sh"
train-mixed = "bash train_mixed.sh"

# Utility tasks
download-models = "bash download_models.sh"
shell = "bash"

# Development feature
[feature.dev.dependencies]
ipython = "*"
jupyter = "*"

[feature.dev.tasks]
notebook = "jupyter notebook --ip=0.0.0.0 --port=8888 --no-browser --allow-root"

# Environments
[environments]
default = { solve-group = "default" }
dev = { features = ["dev"], solve-group = "default" }
